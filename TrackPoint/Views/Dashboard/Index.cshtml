@{
    ViewData["Title"] = "Dashboard";
    bool isAdmin = User.IsInRole("Admin");
}

<style>
    h6 {
        text-align: center;
        font-size: 20px;
    }
    canvas {
        width: 180px !important;
        height: 180px !important;
    }    
    text {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
</style>
<div class="container mt-4 custom-background">

    @* <h2 class="mb-3">Personal Dashboard</h2>  *@
    

    @if (isAdmin)
    {
        <a asp-controller="Dashboard" asp-action="Index" class="btn btn-light btn-sm btn-outline-dark">Personal Dashboard</a>
        <a asp-controller="Dashboard" asp-action="adminDashboard" class="btn btn-light btn-outline-dark btn-sm">Admin View</a>
    }

    <div class="container" style="padding: 18px">
        <div class="row g-4">

            <div class="col-md-4" >
                <div style="border: 1px solid #D3D3D3;border-radius:10px; padding:10px;">       
                    <canvas id="location"></canvas>
                    <h6>My Assets</h6>
                </div>
            </div>

            <div class="col-md-4">
                <div style="border: 1px solid #D3D3D3;border-radius:10px; padding:10px">                   
                    <canvas id="status"></canvas>
                    <h6>Action Required</h6>
                </div>
            </div>

            <div class="col-md-4">
                <div style="border: 1px solid #D3D3D3;border-radius:10px; padding:10px">
                    <canvas id="make"></canvas>
                    <h6>Needs Maintenance</h6>
                </div>
            </div>
        </div>
    </div>
  
    <div class="container" style="padding: 18px">
        <div class="row g-4" style="border: 1px solid #D3D3D3;border-radius:10px; padding:10px;">
            <h6>My Assets</h6>
        </div>
    </div>

    <div class="container" style="padding: 18px">
        <div class="row g-4" style="border: 1px solid #D3D3D3;border-radius:10px; padding:10px;">
            <h6>Alerts</h6>
        </div>
    </div>






        

<script>
    
        // create charts
        createLocationChart();
        createStatusChart();
        createMakeChart();

    function createLocationChart() {
        const dt = $('#assetTable').DataTable();
        const locationData = dt.column(4).data().toArray();

           // Count occurrences of each location
        const locationCounts = {};
        locationData.forEach(location => {
        locationCounts[location] = (locationCounts[location] || 0) + 1;
    });

    // Sort by count descending and keep top 5
    const top5 = Object.entries(locationCounts)
        .sort((a, b) => b[1] - a[1]) // highest first
        .slice(0, 5);                 // only top 5

    // Convert back to labels and values
    const labels = top5.map(item => item[0]);
    const values = top5.map(item => item[1]);

    console.log(labels, values);

        console.log(labels, values);

        const ctx = document.getElementById('location');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Assets by Location',
                    data: values,
                    borderWidth: 0,
                    backgroundColor: [
                     '#FFD700',  // vibrant yellow/gold
                    '#FF9500', // vibrant orange
                    '#34C759', // vibrant green
                    '#0A84FF', // vibrant blue
                    '#AF52DE'  // vibrant purple
]                   
            
                }]
            },
            options: {
                    plugins: {
                        legend: {
                        display: false, 
                    }
                },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
        });
    }

     function createStatusChart() {
        const dt = $('#assetTable').DataTable();
        const statusData = dt.column(6).data().toArray();

        // assets available vs assets not available
            const statusCounts = {
                Available: 0,
                Unavailable: 0
            };

            statusData.forEach(status => {
                if (status === "InStorage") {
                    statusCounts.Available++;
                } else {
                    statusCounts.Unavailable++;
                }
            });

            const labels = Object.keys(statusCounts);
            const values = Object.values(statusCounts);

            const ctx = document.getElementById('status');
            new Chart(ctx, {
                type: 'doughnut',
                    data: {
                        labels: labels,
                    datasets: [{
                    label: 'Assets by status',
                    data: values,
                    borderWidth: 0,
                    backgroundColor: [
                    '#00C964', // vibrant green (Available)
                    '#FF2B2B', // vibrant red (Unavailable)
                    '#009EFF', // vibrant blue
                    '#FFD300', // vibrant yellow
                    '#FF6D1A'  // vibrant orange],
                    ],
                  
                }]
            },
            options: {
                    plugins: {
                        legend: {
                        display: false, 
                    }
                },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
        });
    }
     function createMakeChart() {
        const dt = $('#assetTable').DataTable();
        const makeData = dt.column(1).data().toArray();

    // Count occurrences of each make
    const makeCounts = {};
    makeData.forEach(make => {
        makeCounts[make] = (makeCounts[make] || 0) + 1;
    });

    // Sort by count descending and keep top 5
    const top5 = Object.entries(makeCounts)
        .sort((a, b) => b[1] - a[1]) // highest first
        .slice(0, 5);                 // only top 5

    // Convert back to labels and values
    const labels = top5.map(item => item[0]);
    const values = top5.map(item => item[1]);

    console.log(labels, values);

        console.log(labels, values);

        const ctx = document.getElementById('make');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Assets by Make',
                    data: values,
                    borderWidth: 0,
                    backgroundColor: [
                    '#00C964', // vibrant green
                    '#007BFF', // vibrant blue
                    '#FFD300', // vibrant yellow
                    '#FF2B2B', // vibrant red
                    '#9B59B6'  // vibrant purple
                ],
                }]
            },
             options: {
                    plugins: {
                        legend: {
                        display: false, 
                    }
                },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
        });
    }
</script>



