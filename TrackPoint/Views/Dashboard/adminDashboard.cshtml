@model TrackPoint.Models.DTOs.AdminDashboardViewModel


@{
    ViewData["Title"] = "Dashboard";
}
<a asp-controller="Dashboard" asp-action="Index" class="btn btn-light btn-sm btn-outline-dark">Personal Dashboard</a>
<a asp-controller="Dashboard" asp-action="AdminDashboard" class="btn btn-primary btn-sm btn-outline-light">Admin View</a>


<style>
    canvas {
        width: 100px !important;
        height: 130px !important;
    }

    .table-div {
        border: 1px solid #D3D3D3;
        border-radius: 10px;
    }
</style>

<div class="container" style="padding: 18px;">
    <div class="row g-3">
        <div class="col-md-3">
            <div class="custom-background"
                 style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">               
                <canvas id="location"></canvas>
                <h6>Needs Attention</h6>
            </div>
        </div>

        @* This will hold assets that arent turned in *@
        <div class="col-md-3">
            <div class="custom-background"
                 style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">
                 <canvas id="status"></canvas>
                 <h6>Overdue</h6>               
            </div>
        </div>

        <div class="col-md-3">
            <div class="custom-background"
                 style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">
                <canvas id="make"></canvas>
                 <h6>Warranty Expiring</h6>          
            </div>
        </div>

        <div class="col-md-3">
            <div class="custom-background"
                 style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">
                <canvas id="make-unassigned"></canvas>
                <div class="display-4">@Model.UnassignedCount</div>
                <h6>Unassigned</h6>
            </div>
        </div>
    </div>
</div>


<div class="container" style="padding: 18px;">
    <div class="row g-3">
        <div class="col-md-6">
            <div class="custom-background"
                 style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">
                <canvas id="make"></canvas>
                <ul>
                    @foreach (var item in Model.StatusCounts)
                    {
                        <li>@item.Label: @item.Count</li>
                    }
                </ul>
                <h6>Asset by Status</h6>
            </div>
        </div>


            <div class="col-md-6">
                <div class="custom-background"
                     style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">
                    <canvas id="make"></canvas>
                    <h6>Warranty Coverage</h6>
                </div>
            </div>
        </div>
    </div>

<div class="container" style="padding: 18px;">
    <div class="row g-3">
        <div class="col-md-12">
            <div class="custom-background"
                 style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">
                <canvas id="make"></canvas>
                <h6>Needs Immediate Action</h6>
            </div>
        </div>

        @* list of assets with upcoming deadlines *@
        <div class="col-md-12">
            <div class="custom-background"
                 style="border: 1px solid #D3D3D3; border-radius:10px; padding:10px;">
                <canvas id="make"></canvas>
                <h6>Upcoming deadlines</h6>
            </div>
        </div>
    </div>
</div>





<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    

        // create charts
        createLocationChart();
        createStatusChart();
        createMakeChart();

       function createLocationChart() {
        const dt = $('#adminTable').DataTable();
        const locationData = dt.column(4).data().toArray();
        const locationCounts = {};
        locationData.forEach(location => {
            locationCounts[location] = (locationCounts[location] || 0) + 1;
        });
        const top5 = Object.entries(locationCounts).sort((a,b) => b[1]-a[1]).slice(0,5);
        const labels = top5.map(i=>i[0]), values = top5.map(i=>i[1]);
        const ctx = document.getElementById('location');
        new Chart(ctx, { type:'doughnut', data:{ labels, datasets:[{ data:values, backgroundColor:['#00D084','#FF3B30','#007BFF','#FFC300','#9B59B6'] }] }, options:{ plugins:{ legend:{ display:false } }, scales:{ x:{display:false}, y:{display:false} } } });
    }

    function createStatusChart() {
        const dt = $('#adminTable').DataTable();
        const statusData = dt.column(6).data().toArray();
        const statusCounts = {};
        statusData.forEach(status => { statusCounts[status] = (statusCounts[status] || 0) + 1; });
        const top5 = Object.entries(statusCounts).sort((a,b)=>b[1]-a[1]).slice(0,5);
        const labels = top5.map(i=>i[0]), values = top5.map(i=>i[1]);
        const ctx = document.getElementById('status');
        new Chart(ctx, { type:'doughnut', data:{ labels, datasets:[{ data:values, backgroundColor:['#00C964','#FF2B2B','#009EFF','#FFD300','#FF6D1A'] }] }, options:{ plugins:{ legend:{ display:false } }, scales:{ x:{display:false}, y:{display:false} } } });
    }

    function createMakeChart() {
        const dt = $('#adminTable').DataTable();
        const makeData = dt.column(1).data().toArray();
        const makeCounts = {};
        makeData.forEach(m => { makeCounts[m] = (makeCounts[m] || 0) + 1; });
        const top5 = Object.entries(makeCounts).sort((a,b)=>b[1]-a[1]).slice(0,5);
        const labels = top5.map(i=>i[0]), values = top5.map(i=>i[1]);
        const ctx = document.getElementById('make');
        new Chart(ctx, { type:'doughnut', data:{ labels, datasets:[{ data:values, backgroundColor:['#00B894','#0984E3','#FDCA40','#FF6B35','#EA2027'] }] }, options:{ plugins:{ legend:{ display:false } }, scales:{ x:{display:false}, y:{display:false} } } });
    }
</script>