@model TrackPoint.Models.DTOs.AdminDashboardViewModel
@using System.Text.Json


@{
    ViewData["Title"] = "Dashboard";
}

<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    canvas {
        width: 260px !important;
        height: 260px !important;
    }

    .col-md-3 {
        align-content: center;
        width: 300px;
        height: 180px;
        
    }
    .page {
        display:flex;
        flex-direction: column;
        gap:25px;
        padding: 20px;
    }

    h1 {
        font-weight: 700;
        font-size: 40px;
        color: #064973;
        letter-spacing: -1px;
    }
    .display-4 {
        text-align: center;
    }
    h6 {
        text-align: center;
        font-weight: 700;

    }

    body {
        background: #f2f2f2;
        font-family: 'DM Sans', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    h4 {
        font-family: 'DM Sans', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        font-weight: 700;
        font-size: 22px;
        color:dimgrey;
        letter-spacing: -1px;
        
    }

    .section {
        align-content: center;
        background: white;
        border: 2px;
        padding: 15px;
        border-radius: 10px;
    }

    .primary-btn {
        width: 100%;
        margin-top: 28px;
        padding: 14px;
        font-size: 15px;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.15s, box-shadow 0.15s;
    }

        .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.35);
        }

    .secondary-btn {
        width: 100%;
        margin-top: 28px;
        padding: 14px;
        font-size: 15px;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.15s, box-shadow 0.15s;
    }

        .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.35);
        }

</style>



    <div class="page">
    <div class="row g-1">
        <div class="col-md-6">
            <h1>Home</h1>
        </div>
        <div class="col-md-6" style="text-align:right">
            <a asp-controller="Report" asp-action="ReportBuilder" class="secondary-btn">
                Generate A Report
            </a>
        </div>
  
        </div>
        <!-- Priority Overview -->
        <div class="section">
            <h4>Priority Overview</h4>
            <div class="d-flex justify-content-between flex-wrap" style="gap: 20px; margin-top: 15px;">
            <div class="custom-background" style="flex: 1 1 220px; border:1px solid #f472b6; border-radius:10px; padding:10px; background-color:rgba(244, 114, 182, 0.25)">
                <div class="display-4" style="color:#f472b6">0</div>
                <h6 style="color:#f472b6">Needs Attention</h6>
                </div>
            <div class="custom-background" style="flex: 1 1 220px; border:1px solid #d8b4fe; border-radius:10px; padding:10px; background-color: rgba(216, 180, 254,0.25)">
                <div class="display-4" style="color:#d8b4fe">0</div>
                <h6 style="color:#d8b4fe">Overdue</h6>
                </div>
            <div class="custom-background" style="flex: 1 1 220px; border:1px solid #14b8a6; border-radius:10px; padding:10px; background-color: rgba(20, 184, 166,0.25)">
                <div class="display-4" style="color:#14b8a6">@Model.ExpiringSoonCount</div>
                <h6 style="color:#14b8a6">Warranty Expiring</h6>
                </div>
            <div class="custom-background" style="flex: 1 1 220px; border:1px solid #3b82f6; border-radius:10px; padding:10px; background-color: rgba(59, 131, 246,0.25)">
                <div class="display-4" style="color:#3b82f6">@Model.UnassignedCount</div>
                <h6 style="color:#3b82f6">Unassigned</h6>
                </div>
            </div>
        </div>

        <!-- System Overview -->
        <div class="section">
            <h4>System Overview</h4>
            <div class="d-flex flex-wrap justify-content-between" style="gap: 20px; margin-top: 15px;">
                <div class="custom-background" style="flex: 1 1 45%; border:1px solid #D3D3D3; border-radius:10px; padding:10px;">
                    <canvas id="statusChart"></canvas>
                    <h6>Asset by Status</h6>
                </div>
                <div class="custom-background" style="flex: 1 1 45%; border:1px solid #D3D3D3; border-radius:10px; padding:10px;">
                    <canvas id="warranty"></canvas>
                    <h6>Warranty Coverage</h6>
                </div>
            </div>
        </div>

        <!-- Action Center -->
        <div class="section">
            <h4>Action Center</h4>
            <div class="d-flex flex-column" style="gap: 20px; margin-top: 15px;">
                <div class="custom-background" style="border:1px solid #D3D3D3; border-radius:10px; padding:10px;">
                    <canvas id="make"></canvas>
                    <h6>Needs Immediate Action</h6>
                </div>
                <div class="custom-background" style="border:1px solid #D3D3D3; border-radius:10px; padding:10px;">
                    <canvas id="make"></canvas>
                    <h6>Pending Approvals</h6>
                </div>
            </div>
        </div>

    </div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    //create charts 
    DrawAssetChart();
    DrawWarrantyChart();

            function DrawAssetChart() {
        // Labels and data from server
        const labels = @Html.Raw(JsonSerializer.Serialize(Model.StatusCounts.Select(s => s.Label)));
        const data = @Html.Raw(JsonSerializer.Serialize(Model.StatusCounts.Select(s => s.Count)));

        const ctx = document.getElementById('statusChart').getContext('2d');

        // Purple-centric SaaS palette
        const backgroundColors = [
            '#14b8a6', // Teal
            '#7c3aed', // Purple
            '#3b82f6', // Blue
            '#6366f1', // Indigo
            '#9333ea', // Darker Purple
            '#f472b6', // Pink
            '#facc15', // Amber
            '#ec4899'  // Magenta
        ];

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors.slice(0, data.length),
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            boxWidth: 15,
                            padding: 20,
                            font: { size: 14 }
                        }
                    },
                    tooltip: {
                        enabled: true,
                        backgroundColor: '#1F2937',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 10
                    }
                }
            }
        });
    }

    function DrawWarrantyChart() {
        // Values from server
        const expired = @Html.Raw(JsonSerializer.Serialize(Model.ExpiredCount));
        const zeroToThirty = @Html.Raw(JsonSerializer.Serialize(Model.ZeroToThirty));
        const thirtyOneToNinety = @Html.Raw(JsonSerializer.Serialize(Model.ThirtyOneToNinety));
        const ninetyPlus = @Html.Raw(JsonSerializer.Serialize(Model.NinetyPlus));
        const totalAssets = @Html.Raw(JsonSerializer.Serialize(Model.StatusCounts.Sum(s => s.Count)));
        const noWarranty = Math.max(0, totalAssets - (expired + zeroToThirty + thirtyOneToNinety + ninetyPlus));

        const labels = ['No Warranty', 'Expired', '0-30 days', '31-90 days', '90+ days'];
        const data = [noWarranty, expired, zeroToThirty, thirtyOneToNinety, ninetyPlus];

        const ctx = document.getElementById('warranty').getContext('2d');

        // Purple/teal SaaS palette
        const backgroundColors = [
            '#d8b4fe', // Light Purple - No Warranty
            '#7c3aed', // Purple - Expired
            '#9333ea', // Darker Purple - 0-30
            '#14b8a6', // Teal - 31-90
            '#f472b6'  // Pink - 90+
        ];

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors,
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: { boxWidth: 15, padding: 20, font: { size: 14 } }
                    },
                    tooltip: {
                        enabled: true,
                        backgroundColor: '#1F2937',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 10
                    }
                }
            }
        });
    }
</script>